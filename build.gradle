plugins {
    id 'java'
    id 'maven-publish'
}

configurations {
    bundleLib
}

group 'berlin.giz.keycloak'
version '1.0.10'

ext {
    keycloakVersion = '24.0.3'
}

repositories {
    mavenCentral()
    maven {
        url "https://gitlab.desy.de/api/v4/projects/7797/packages/maven"
        name "GitLab"
        credentials(HttpHeaderCredentials) {
            name = 'Job-Token'
            value = System.getenv()['CI_JOB_TOKEN']
        }
        authentication {
            header(HttpHeaderAuthentication)
        }
    }
}

publishing {
    publications {
        library(MavenPublication) {
            from components.java
        }
    }
    repositories {
        maven {
            url "https://gitlab.desy.de/api/v4/projects/7797/packages/maven"
            name "GitLab"
            credentials(HttpHeaderCredentials) {
                name = 'Job-Token'
                value = System.getenv()['CI_JOB_TOKEN']
            }
            authentication {
                header(HttpHeaderAuthentication)
            }
        }
   }
}

dependencies {
    implementation "org.keycloak:keycloak-services:$keycloakVersion"
    implementation "org.keycloak:keycloak-server-spi:$keycloakVersion"
    implementation "org.keycloak:keycloak-server-spi-private:$keycloakVersion"
}

test {
    useJUnitPlatform()
}

jar {
    from {
        configurations.bundleLib.collect { it.isDirectory() ? it : zipTree(it) }
    }
}
